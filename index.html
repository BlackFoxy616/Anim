<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Link Updater</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <form class="login">
    <h1>Link Updater</h1>
    <br> 
    <label for="url">URL:</label>
    <input type="text" id="url" name="url">
    <br>
    <button id="shorten-btn">Update</button>
    <p id="status"></p>
    </form>
    <script>
      const GIST_ID = '4570ddd630a3eb3ae757db3d440a163b';
      const FILE_NAME = 'links.txt';
      const GITHUB_TOKEN = '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';

      const urlInput = document.getElementById('url');
      const shortenBtn = document.getElementById('shorten-btn');
      const statusMsg = document.getElementById('status');

      shortenBtn.addEventListener('click', () => {
        const url = urlInput.value;

        fetch(`https://api.github.com/gists/${GIST_ID}`, {
          headers: {
            'Authorization': `Bearer ${GITHUB_TOKEN}`,
          },
        })
          .then(res => res.json())
          .then(gist => {
            const fileContent = gist.files[FILE_NAME].content;

            const newLine = `${url}\n`;
            const updatedContent = fileContent + newLine;

            return fetch(`https://api.github.com/gists/${GIST_ID}`, {
              method: 'PATCH',
              headers: {
                'Authorization': `Bearer ${GITHUB_TOKEN}`,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                files: {
                  [FILE_NAME]: {
                    content: updatedContent,
                  },
                },
              }),
            });
          })
          .then(res => {
            if (res.ok) {
              statusMsg.textContent = 'URL shortened successfully!';
              uniqueidInput.value = '';
              urlInput.value = '';
            } else {
              statusMsg.textContent = 'Error shortening URL.';
            }
          })
          .catch(err => {
            console.error(err);
            statusMsg.textContent = 'Error shortening URL.';
          });
      });
    </script>
  </body>
</html>
